<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDS Real-Time Monitoring Dashboard</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive chart containers */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    
    <!-- Header -->
    <header class="bg-gray-800 shadow-lg border-b border-gray-700">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-600 p-3 rounded-lg">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Intrusion Detection System</h1>
                        <p class="text-sm text-gray-400">Real-Time Network Monitoring with MLP AI</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div id="statusIndicator" class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-gray-500 rounded-full"></div>
                        <span class="text-sm text-gray-400">Idle</span>
                    </div>
                    <button id="startBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold transition duration-200 flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Start Monitoring</span>
                    </button>
                    <button id="stopBtn" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-semibold transition duration-200 hidden flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
                        </svg>
                        <span>Stop Monitoring</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        
        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            
            <!-- Total Samples -->
            <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm font-medium">Total Samples</p>
                        <p id="totalSamples" class="text-3xl font-bold text-white mt-2">0</p>
                    </div>
                    <div class="bg-blue-600 bg-opacity-20 p-3 rounded-lg">
                        <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Normal Traffic -->
            <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm font-medium">Normal Traffic</p>
                        <p id="normalCount" class="text-3xl font-bold text-green-400 mt-2">0</p>
                    </div>
                    <div class="bg-green-600 bg-opacity-20 p-3 rounded-lg">
                        <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Anomalies Detected -->
            <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm font-medium">Anomalies Detected</p>
                        <p id="anomalyCount" class="text-3xl font-bold text-red-400 mt-2">0</p>
                    </div>
                    <div class="bg-red-600 bg-opacity-20 p-3 rounded-lg">
                        <svg class="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Detection Rate -->
            <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm font-medium">Normal Rate</p>
                        <p id="normalRate" class="text-3xl font-bold text-purple-400 mt-2">0%</p>
                    </div>
                    <div class="bg-purple-600 bg-opacity-20 p-3 rounded-lg">
                        <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            
            <!-- Doughnut Chart -->
            <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700">
                <div class="px-6 py-4 border-b border-gray-700">
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <svg class="w-6 h-6 mr-2 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                        </svg>
                        Traffic Distribution
                    </h2>
                </div>
                <div class="p-6">
                    <div class="chart-container">
                        <canvas id="trafficChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Real-time Line Chart -->
            <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700">
                <div class="px-6 py-4 border-b border-gray-700">
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <svg class="w-6 h-6 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                        </svg>
                        Real-Time Traffic Flow
                    </h2>
                </div>
                <div class="p-6">
                    <div class="chart-container">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Grid - Predictions and Bar Chart -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Live Predictions Feed -->
            <div class="lg:col-span-2">
                <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700">
                    <div class="px-6 py-4 border-b border-gray-700">
                        <h2 class="text-xl font-bold text-white flex items-center">
                            <svg class="w-6 h-6 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            Live Predictions
                        </h2>
                    </div>
                    <div id="predictionFeed" class="p-6 space-y-3 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 py-12">
                            <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                            </svg>
                            <p class="text-lg">No predictions yet</p>
                            <p class="text-sm mt-2">Start monitoring to see real-time predictions</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bar Chart - Cumulative Stats -->
            <div class="lg:col-span-1">
                <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700">
                    <div class="px-6 py-4 border-b border-gray-700">
                        <h2 class="text-xl font-bold text-white flex items-center">
                            <svg class="w-6 h-6 mr-2 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Detection Stats
                        </h2>
                    </div>
                    <div class="p-6">
                        <div class="chart-container">
                            <canvas id="barChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // Socket.IO connection
        const socket = io('http://localhost:5000');
        
        let monitoringActive = false;
        let predictionCount = 0;

        // Chart contexts
        const doughnutCtx = document.getElementById('trafficChart').getContext('2d');
        const lineCtx = document.getElementById('lineChart').getContext('2d');
        const barCtx = document.getElementById('barChart').getContext('2d');

        // Doughnut Chart setup
        const trafficChart = new Chart(doughnutCtx, {
            type: 'doughnut',
            data: {
                labels: ['Normal', 'Anomaly'],
                datasets: [{
                    data: [0, 0],
                    backgroundColor: ['#10b981', '#ef4444'],
                    borderColor: ['#1f2937', '#1f2937'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#e5e7eb',
                            font: { size: 12 }
                        }
                    }
                }
            }
        });

        // Line Chart setup (Real-time flow)
        const lineChart = new Chart(lineCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Normal',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Anomaly',
                        data: [],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        ticks: { color: '#9ca3af' },
                        grid: { color: '#374151' }
                    },
                    y: {
                        ticks: { color: '#9ca3af' },
                        grid: { color: '#374151' },
                        beginAtZero: true
                    }
                },
                plugins: {
                    legend: {
                        labels: { color: '#e5e7eb' }
                    }
                }
            }
        });

        // Bar Chart setup
        const barChart = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: ['Normal', 'Anomaly'],
                datasets: [{
                    label: 'Count',
                    data: [0, 0],
                    backgroundColor: ['#10b981', '#ef4444'],
                    borderColor: ['#059669', '#dc2626'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        ticks: { color: '#9ca3af' },
                        grid: { display: false }
                    },
                    y: {
                        ticks: { color: '#9ca3af' },
                        grid: { color: '#374151' },
                        beginAtZero: true
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });

        // Track normal/anomaly over time for line chart
        let normalTimeSeries = [];
        let anomalyTimeSeries = [];
        let timeLabels = [];
        let maxPoints = 20;

        // DOM elements
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const statusIndicator = document.getElementById('statusIndicator');
        const predictionFeed = document.getElementById('predictionFeed');
        const totalSamplesEl = document.getElementById('totalSamples');
        const normalCountEl = document.getElementById('normalCount');
        const anomalyCountEl = document.getElementById('anomalyCount');
        const normalRateEl = document.getElementById('normalRate');

        // Start monitoring
        startBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:5000/api/start', {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.status === 'started' || data.status === 'already_running') {
                    monitoringActive = true;
                    startBtn.classList.add('hidden');
                    stopBtn.classList.remove('hidden');
                    updateStatus('active');
                    clearPlaceholder();
                }
            } catch (error) {
                console.error('Error starting monitoring:', error);
                alert('Failed to start monitoring. Make sure the backend is running.');
            }
        });

        // Stop monitoring
        stopBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:5000/api/stop', {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.status === 'stopped') {
                    monitoringActive = false;
                    stopBtn.classList.add('hidden');
                    startBtn.classList.remove('hidden');
                    updateStatus('idle');
                }
            } catch (error) {
                console.error('Error stopping monitoring:', error);
            }
        });

        // Update status indicator
        function updateStatus(status) {
            if (status === 'active') {
                statusIndicator.innerHTML = `
                    <div class="w-3 h-3 bg-green-500 rounded-full pulse-dot"></div>
                    <span class="text-sm text-green-400 font-semibold">Active</span>
                `;
            } else {
                statusIndicator.innerHTML = `
                    <div class="w-3 h-3 bg-gray-500 rounded-full"></div>
                    <span class="text-sm text-gray-400">Idle</span>
                `;
            }
        }

        // Clear placeholder
        function clearPlaceholder() {
            if (predictionCount === 0) {
                predictionFeed.innerHTML = '';
            }
        }

        // Add prediction to feed
        function addPrediction(data) {
            predictionCount++;
            clearPlaceholder();
            
            const isAnomaly = data.prediction === 'Anomaly';
            const bgColor = isAnomaly ? 'bg-red-900 border-red-700' : 'bg-green-900 border-green-700';
            const textColor = isAnomaly ? 'text-red-400' : 'text-green-400';
            const icon = isAnomaly ? 
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>' :
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
            
            const predictionCard = `
                <div class="slide-in ${bgColor} border rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <svg class="w-6 h-6 ${textColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                ${icon}
                            </svg>
                            <div>
                                <p class="font-semibold ${textColor}">${data.prediction}</p>
                                <p class="text-xs text-gray-400">${data.timestamp}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-bold text-white">${data.confidence.toFixed(2)}%</p>
                            <p class="text-xs text-gray-400">Confidence</p>
                        </div>
                    </div>
                </div>
            `;
            
            predictionFeed.insertAdjacentHTML('afterbegin', predictionCard);
            
            // Keep only last 20 predictions
            const cards = predictionFeed.children;
            if (cards.length > 20) {
                predictionFeed.removeChild(cards[cards.length - 1]);
            }
        }

        // Update statistics and charts
        function updateStats(stats) {
            totalSamplesEl.textContent = stats.total_samples;
            normalCountEl.textContent = stats.normal_count;
            anomalyCountEl.textContent = stats.anomaly_count;
            
            const normalRate = stats.total_samples > 0 
                ? ((stats.normal_count / stats.total_samples) * 100).toFixed(1)
                : 0;
            normalRateEl.textContent = normalRate + '%';
            
            // Update doughnut chart
            trafficChart.data.datasets[0].data = [stats.normal_count, stats.anomaly_count];
            trafficChart.update('none'); // 'none' for performance
            
            // Update bar chart
            barChart.data.datasets[0].data = [stats.normal_count, stats.anomaly_count];
            barChart.update('none');
            
            // Update line chart (time series)
            const currentTime = new Date().toLocaleTimeString();
            timeLabels.push(currentTime);
            normalTimeSeries.push(stats.normal_count);
            anomalyTimeSeries.push(stats.anomaly_count);
            
            // Keep only last maxPoints
            if (timeLabels.length > maxPoints) {
                timeLabels.shift();
                normalTimeSeries.shift();
                anomalyTimeSeries.shift();
            }
            
            lineChart.data.labels = timeLabels;
            lineChart.data.datasets[0].data = normalTimeSeries;
            lineChart.data.datasets[1].data = anomalyTimeSeries;
            lineChart.update('none');
        }

        // Socket.IO event listeners
        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('initial_data', (data) => {
            console.log('Received initial data:', data);
            if (data.stats) {
                updateStats(data.stats);
            }
            if (data.recent_predictions) {
                data.recent_predictions.forEach(pred => addPrediction(pred));
            }
            if (data.monitoring_active) {
                monitoringActive = true;
                startBtn.classList.add('hidden');
                stopBtn.classList.remove('hidden');
                updateStatus('active');
            }
        });

        socket.on('new_prediction', (data) => {
            addPrediction(data);
        });

        socket.on('stats_update', (data) => {
            updateStats(data);
        });

        socket.on('disconnect', () => {
            console.log('Disconnected from server');
            updateStatus('idle');
        });

        // Load initial stats on page load
        async function loadInitialStats() {
            try {
                const response = await fetch('http://localhost:5000/api/stats');
                const stats = await response.json();
                updateStats(stats);
            } catch (error) {
                console.error('Error loading initial stats:', error);
            }
        }

        loadInitialStats();
    </script>
</body>
</html>
